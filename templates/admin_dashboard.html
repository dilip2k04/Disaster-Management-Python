{% extends "base.html" %}

{% block content %}

<div class="dashboard-header bg-white border-bottom py-3 mb-4">
  <div class="container d-flex justify-content-between align-items-center">
    <div>
      <h2 class="mb-0">
        <i class="bi bi-shield-exclamation text-danger"></i>
        Admin Dashboard
      </h2>
      <small class="text-muted">Manage alerts & users</small>
    </div>

    <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-secondary">
      Logout
    </a>
  </div>
</div>


<div class="container">

  <!-- ================= ALERT FORM ================= -->
  <div class="row g-4">

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-light fw-bold">
          üö® Send Emergency Alert
        </div>

        <div class="card-body">

          <form method="POST" action="{{ url_for('add_alert') }}">

            <div class="mb-3">
              <label class="form-label">Title</label>
              <input name="title" class="form-control" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Message</label>
              <textarea name="message" rows="3" class="form-control" required></textarea>
            </div>

            <!-- LOCATION FILTER -->
            <div class="mb-3">
              <label class="form-label">Send only to location (optional)</label>
              <input name="location" class="form-control" placeholder="Leave empty = all users">
            </div>

            <button class="btn btn-danger w-100">
              Send Alert (SMS + Email)
            </button>

          </form>

        </div>
      </div>
    </div>


    <!-- ================= USERS TABLE ================= -->

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-light fw-bold">
          üë• Registered Users ({{ users|length }})
        </div>

        <div class="table-responsive">
          <table class="table table-hover mb-0">

            <thead class="table-light">
              <tr>
                <th>Email</th>
                <th>Phone</th>
                <th>Location</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              {% for user in users %}
              <tr>
                <td>{{ user.email }}</td>
                <td>{{ user.phone }}</td>
                <td>{{ user.location }}</td>
                <td>

                  <form action="{{ url_for('admin_delete_user', user_id=user.id) }}"
                        method="POST"
                        onsubmit="return confirm('Delete this user?')">

                    <button class="btn btn-sm btn-outline-danger">
                      Delete
                    </button>

                  </form>

                </td>
              </tr>
              {% endfor %}
            </tbody>

          </table>
        </div>
      </div>
    </div>


    <!-- ================= ALERT HISTORY ================= -->

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light fw-bold">
          üïí Alert History
        </div>

        <div class="table-responsive">

          <table class="table table-bordered mb-0">

            <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Message</th>
                <th>Created</th>
              </tr>
            </thead>

            <tbody>
              {% for alert in alerts %}
              <tr>
                <td>{{ alert.title }}</td>
                <td>{{ alert.message }}</td>
                <td>{{ alert.created_at }}</td>
              </tr>
              {% endfor %}
            </tbody>

          </table>

        </div>
      </div>
    </div>


    <!-- ================= VOLUNTEERS ================= -->

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light fw-bold">
          ‚ù§Ô∏è Volunteers ({{ volunteers|length }})
        </div>

        <div class="table-responsive">

          <table class="table table-hover mb-0">

            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Age</th>
                <th>Email</th>
                <th>Phone</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              {% for v in volunteers %}
              <tr>
                <td>{{ v.name }}</td>
                <td>{{ v.age }}</td>
                <td>{{ v.email }}</td>
                <td>{{ v.phone }}</td>
                <td>

                  <form action="{{ url_for('admin_delete_volunteer', vol_id=v.id) }}"
                        method="POST"
                        onsubmit="return confirm('Delete volunteer?')">

                    <button class="btn btn-sm btn-outline-danger">
                      Delete
                    </button>

                  </form>

                </td>
              </tr>
              {% endfor %}
            </tbody>

          </table>

        </div>
      </div>
    </div>

  </div>

</div>

{% endblock %}
